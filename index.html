<html>
    <head>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.4.4.min.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.7/jquery-ui.min.js"></script>
        
        <link href="ui-lightness/jquery-ui-1.8.7.custom.css" rel="stylesheet" type="text/css" /> 
        <style type="text/css">
            body
            {
                margin: 30px 0 100px 0;
            }
            
            #tag-image
            {
                border: solid 1px #ddd;
            }
            
            #tag-control
            {
                position: fixed;
                top: 0px;
                left: 0px;
                width: 100%;
                padding: 3px;
                border-bottom: solid 2px #BF860B;
                background-color: #F1A50A;
                text-align: center;
                height: 30px;
                z-index: 9999;
            }
        
            #tag-info
            {
                position: fixed;
                bottom: 0px;
                left: 0px;
                width: 100%;
                padding: 3px;
                border-top: solid 2px #BF860B;
                background-color: #fff;
                z-index: 9999;
                color: #333;
            }
        
            div.tag
            {
                position: absolute;
                width: 100px;
                height: 100px;
                border: solid 2px #CF0000;
                
                cursor: move;
            }
        </style>
        
        <script type="text/javascript">
            var nMask, sMask, eMask, wMask;
            var tTop, tLeft, tRight, tBottom;
            
            function drawMasks( tElm )
            {
                var i = $("#tag-image");
                
                nMask.css("height", tTop + "px" );
                sMask.css(
                {
                    "height": tBottom + "px",
                    "top":  (i.offset().top + i.height()) - tBottom + 4
                });
                eMask.css(
                {
                    height: tElm.outerHeight(),
                    width: tLeft + "px",
                    top: tElm.position().top
                });
                
                wMask.css(
                {
                    height: tElm.outerHeight(),
                    width: tRight - 4 + "px",
                    top: tElm.position().top,
                    left: i.offset().left + tLeft + $(tElm).outerWidth()
                });
            }
            
            function calcTagDimensions( tElm )
            {
                $("#tWidth").html( $(tElm).width() );
                $("#tHeight").html( $(tElm).height() );                
            
            
                var p = $(tElm).offset();              
                var image = $("#tag-image");
                var imageOffset = $("#tag-image").offset();
                
                tTop    = p.top - imageOffset.top;
                tLeft   = p.left - imageOffset.left;
                tRight  = image.width() - ( tLeft + $(tElm).width() );
                tBottom = image.height() - ( tTop + $(tElm).height() );
                
                $("#tTop").html( tTop );
                $("#tLeft").html( tLeft );
                $("#tRight").html( tRight );
                $("#tBottom").html( tBottom );            
            }
            
            $(function()
            {
                $("#tag-image").width( $("body").width() );
            
                var maskStyles = { position: 'absolute', overflow: 'hidden', 'background-color': '#333', opacity: '0.8' };
                nMask = jQuery("<div/>").css( maskStyles ).appendTo( $("#tag-area") );
                sMask = jQuery("<div/>").css( maskStyles ).css("bottom", "0px").prependTo( $("#tag-area") );
                eMask = jQuery("<div/>").css( maskStyles ).prependTo( $("#tag-area") );
                wMask = jQuery("<div/>").css( maskStyles ).prependTo( $("#tag-area") );
            
                nMask.css(
                {
                    "width": $("#tag-image").width(),
                    "top": $("#tag-image").position().top
                });
                sMask.css("width", $("#tag-image").width());
            
                $(".tag").draggable(
                {
                    drag: function( e, ui )
                    {
                        var t = $(this);

                        calcTagDimensions( t );
                        drawMasks( t );
                    },
                    
                    stop: function()
                    {
                        var t = $(this);

                        calcTagDimensions( t );
                        drawMasks( t );
                    }
                });
                
                $(".tag").resizable(
                {
                    containment: $("#tag-area"),
                    handles: "n, e, s, w, ne, se, sw, nw",
                    autohide: true,
                    maxWidth: $("#tag-image").width(),
                    maxHeight: $("#tag-image").height(),
                    resize: function( e, ui )
                    {
                        var t = $(this);

                        calcTagDimensions( t );
                        drawMasks( t );
                    },
                    stop: function()
                    {
                        var t = $(this);

                        calcTagDimensions( t );
                        drawMasks( t );
                    }                    
                });
            });
        </script>
    </head>
    <body>
        <div id="tag-control">
        
        </div>
    
        <div id="tag-info">
            w: <span id="tWidth"></span>; h: <span id="tHeight"></span><br />
            top: <span id="tTop"></span>; left: <span id="tLeft"></span>; right: <span id="tRight"></span>; bottom: <span id="tBottom"></span>
        </div>
        
        <div id="tag-area">
            <div class="tag"></div>
            <img id="tag-image" src="200.png"  />
        </div>
    </body>
</html>